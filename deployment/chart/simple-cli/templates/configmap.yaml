{{- $regions := list "" }}
{{- if .Values.multiRegion.enabled }}
{{- $regions = .Values.multiRegion.regions }}
{{- end }}

{{- range $index, $region := $regions }}
{{- $regionSuffix := "" }}
{{- if $region }}
{{- $regionSuffix = printf "-%s" $region.name }}
{{- end }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $.Release.Name }}-config{{ $regionSuffix }}
  namespace: {{ $.Release.Namespace }}
data:
  mcp.json: |
    {
      "mcpServers": {
        "brain": {
          "url": "http://{{ $.Release.Name }}-brain{{ $regionSuffix }}:{{ $.Values.brain.service.port }}/sse"
        },
        "health_monitor": {
          "url": "http://localhost:{{ $.Values.healthMonitor.port }}/sse"
        },
        "filesystem": {
          "command": "node",
          "args": ["/app/node_modules/@modelcontextprotocol/server-filesystem/dist/index.js", "/app"]
        },
        "git": {
          "command": "node",
          "args": ["/app/node_modules/@modelcontextprotocol/server-git/dist/index.js"]
        }
      }
    }
  {{- if $.Values.multiRegion.enabled }}
  failedRegions: ""
  {{- end }}
{{- end }}
