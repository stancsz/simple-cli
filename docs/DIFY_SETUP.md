# Dify Local Setup & Agent Configuration

This guide details how to set up Dify locally and configure a multi-agent coding workflow with **Claude Code** (as Supervisor) and **DeepSeek Coder** (as Coding Agent).

## Prerequisites

- **Docker** and **Docker Compose** installed.
- **Git** installed.
- API Keys for:
  - **DeepSeek** (for Coding Agent and Supervisor reasoning)
  - **Anthropic** (Optional, if using actual Claude 3.5 Sonnet for Supervisor)

## 1. Installation

We have provided a script to automate the initial setup.

```bash
./scripts/setup_dify.sh
```

This script will:
1.  Clone the Dify repository into `.dify/`.
2.  Configure the environment.
3.  Print the command to start the server.

To start Dify:

```bash
cd .dify/docker
docker compose up -d
```

Once running, access the Dify console at: [http://localhost/install](http://localhost/install)

Create an admin account to proceed.

## 2. Model Configuration

Before creating agents, you must configure the Model Providers.

1.  Click on your avatar in the top-right corner -> **Settings**.
2.  Go to **Model Provider**.
3.  **DeepSeek**:
    - Click "Add Model".
    - Select "DeepSeek".
    - Enter your API Key.
    - Ensure `deepseek-chat` (V3) and `deepseek-coder` (V2) are available.
4.  **Anthropic** (for Claude):
    - Click "Add Model".
    - Select "Anthropic".
    - Enter your API Key.
    - Ensure `claude-3-5-sonnet-20240620` is available.

## 3. Creating the Coding Project App

We will create a "Chatflow" application that orchestrates two agents: a Supervisor and a Coder.

1.  Go to **Studio** -> **Create from Blank**.
2.  **App Name**: `Coding Project Agent`.
3.  **App Type**: `Chatflow`.
4.  **Description**: `Supervisor (Claude/DeepSeek) + Coding Agent (DeepSeek Coder)`.

### Step 3.1: Configure the Supervisor Node

The Supervisor is responsible for breaking down the user's request and planning.

1.  In the canvas, locate the **Start** node.
2.  Add a generic **LLM** node connected to Start. Rename it to `Supervisor`.
3.  **Configuration**:
    - **Model**: `Claude 3.5 Sonnet` (Anthropic) OR `DeepSeek Chat` (DeepSeek).
        - *Note: Claude 3.5 Sonnet is recommended for high-level reasoning.*
    - **System Prompt**:
      ```text
      You are a Senior Technical Supervisor (Claude Code Persona).
      Your goal is to analyze the user's coding request, break it down into a step-by-step implementation plan, and delegate it to the Coding Agent.

      Rules:
      1. Analyze the request deeply.
      2. If the request is ambiguous, ask clarifying questions (return text directly).
      3. If clear, output a strictly formatted plan for the Coding Agent.
      ```
    - **Context**: Enable if you want it to remember previous turns.

### Step 3.2: Configure the Coding Agent Node

The Coding Agent implements the plan using a specialized coding model.

1.  Add another **LLM** node connected to the Supervisor. Rename it to `Coding Agent`.
2.  **Configuration**:
    - **Model**: `DeepSeek Coder` (e.g., `deepseek-coder` or `deepseek-v3`).
    - **System Prompt**:
      ```text
      You are a Senior Software Engineer (Codex Persona).
      You receive a technical plan from the Supervisor.
      Your goal is to write clean, efficient, and well-documented code based on the plan.
      Return the code blocks clearly.
      ```
    - **Input Variable**: Select the output from the `Supervisor` node.

### Step 3.3: Output

1.  Connect the `Coding Agent` node to the **Answer** node.
2.  Ensure the `Answer` node outputs the text generated by the Coding Agent.

## 4. Testing

1.  Click **Run** or **Preview** in the top right.
2.  Enter a request: "Create a Python script to scrape a website using BeautifulSoup."
3.  Verify that:
    - The Supervisor analyzes the task.
    - The Coding Agent generates the code.
    - The final answer is displayed.

## 5. Advanced: Tool Integration

To make this agent truly powerful locally, you can add tools:

- **HTTP Request**: To call external APIs.
- **Code Interpreter**: To run Python code (sandboxed).

In Dify, you can add a **Tool** node between the Supervisor and Coding Agent if needed.
