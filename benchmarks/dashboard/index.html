<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple-CLI Performance Benchmarks</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        h1, h2 { color: #333; }
        .chart-container { position: relative; height: 300px; width: 100%; margin-bottom: 40px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .highlight { color: #2ecc71; font-weight: bold; }
        .warning { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Simple-CLI Performance Benchmarks</h1>
    <p>Last Updated: <span id="timestamp">Loading...</span></p>

    <div class="grid">
        <div>
            <h2>Execution Time (ms)</h2>
            <div class="chart-container">
                <canvas id="timeChart"></canvas>
            </div>
        </div>
        <div>
            <h2>Token Usage</h2>
            <div class="chart-container">
                <canvas id="tokenChart"></canvas>
            </div>
        </div>
    </div>

    <h2>Detailed Results</h2>
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Task</th>
                <th>Framework</th>
                <th>Duration (ms)</th>
                <th>Tokens</th>
                <th>Est. Cost ($)</th>
                <th>Success</th>
            </tr>
        </thead>
        <tbody>
            <!-- Populated by JS -->
        </tbody>
    </table>

    <script>
        async function loadData() {
            try {
                // Fetch data.json from adjacent directory
                const response = await fetch('../data.json');
                if (!response.ok) throw new Error("Failed to load benchmark data");
                const data = await response.json();

                document.getElementById('timestamp').textContent = new Date(data.timestamp).toLocaleString();

                const tasks = {};

                // Group by Task
                // Data format: { timestamp: ..., results: [ { task, framework, duration_ms, tokens, cost }, ... ] }
                // integration_speed is a single entry usually (Simple-CLI only)
                // code_editing, research, ui_automation have pairs (Direct vs Simple-CLI)

                data.results.forEach(r => {
                    if (!tasks[r.task]) tasks[r.task] = [];
                    tasks[r.task].push(r);
                });

                const labels = Object.keys(tasks).filter(t => t !== 'integration_speed'); // Comparative tasks

                // Prepare Chart Data
                const simpleCliTime = [];
                const baselineTime = [];
                const simpleCliTokens = [];
                const baselineTokens = [];

                labels.forEach(task => {
                    const simple = tasks[task].find(r => r.framework.includes('Simple-CLI'));
                    const baseline = tasks[task].find(r => !r.framework.includes('Simple-CLI'));

                    simpleCliTime.push(simple ? simple.duration_ms : 0);
                    baselineTime.push(baseline ? baseline.duration_ms : 0);

                    simpleCliTokens.push(simple ? simple.tokens : 0);
                    baselineTokens.push(baseline ? baseline.tokens : 0);
                });

                // Render Charts
                new Chart(document.getElementById('timeChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Direct Usage (Baseline)', data: baselineTime, backgroundColor: '#95a5a6' },
                            { label: 'Simple-CLI', data: simpleCliTime, backgroundColor: '#3498db' }
                        ]
                    },
                    options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'ms' } } } }
                });

                new Chart(document.getElementById('tokenChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Direct Usage (Baseline)', data: baselineTokens, backgroundColor: '#95a5a6' },
                            { label: 'Simple-CLI', data: simpleCliTokens, backgroundColor: '#2ecc71' } // Green for efficiency
                        ]
                    },
                    options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Tokens' } } } }
                });

                // Populate Table
                const tbody = document.querySelector('#resultsTable tbody');
                data.results.forEach(r => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${r.task}</td>
                        <td>${r.framework}</td>
                        <td>${r.duration_ms.toFixed(0)}</td>
                        <td>${r.tokens || 0}</td>
                        <td>$${(r.cost || 0).toFixed(4)}</td>
                        <td>${r.success !== false ? '<span class="highlight">Pass</span>' : '<span class="warning">Fail</span>'}</td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (e) {
                document.getElementById('timestamp').textContent = "Error loading data: " + e.message;
            }
        }

        loadData();
    </script>
</body>
</html>
